resources:
  repositories:
  - repository: pipelines_repo
    type: github
    endpoint: github.com_amd-jmacaran
    name: amd-jmacaran/pipelines

trigger:
- develop

pool: gfx1100

jobs:
- job: rocm_smi_lib
  workspace:
    clean: all
  steps:
  - template: templates/steps/preamble.yml@pipelines_repo
  - template: templates/steps/checkout.yml@pipelines_repo

  - script: |
      mkdir -p build
      cd build
      cmake -DBUILD_TESTS=ON ..
      make -j $(nproc)
      sudo make install
      cd tests/rocm_smi_test 
      ./rsmitst --gtest_output=xml:test_output.xml
  - task: PublishTestResults@2
    inputs:
      testResultsFormat: 'junit'
      testResultsFiles: '**/test_output.xml' 
    condition: succeededOrFailed()
    displayName: 'rocRAND Test Results'
      



    
